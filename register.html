<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <title>Form Pendaftaran</title>
    <link rel="stylesheet" href="./CSS/register.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="./js/jquery-3.7.0.min.js"></script>
    <script src="js/lazyload.js"></script>
    <script src="js/preload.js"></script>
  </head>
  <body>
    <div class="container">
      <input type="checkbox" id="flip" />
      <div class="cover">
        <div class="front">
          <div class="text">
            <span class="text-1">Menabung Dari Muda<br />Untuk Masa Tua</span>
            <span class="text-2">......</span>
          </div>
        </div>
        <div class="back">
          <!-- <img class="backImg" src="images/backImg.jpg" alt=""> -->
          <div class="text">
            <span class="text-1"
              >1000 Mil Jauhnya <br />Dimulai Dari Langkah Pertama</span
            >
            <span class="text-2">Let's get started</span>
          </div>
        </div>
      </div>
      <div class="forms">
        <div class="form-content">
          <div class="login-form">
            <div class="title">Masuk</div>
            <!-- Konten form login -->
            <div class="input-boxes">
              <div class="input-box">
                <i class="fas fa-envelope"></i>
                <input
                  type="text"
                  placeholder="Masukan Email"
                  id="email-input-login"
                  name="email"
                  required
                />
              </div>
              <div class="input-box">
                <i class="fas fa-lock"></i>
                <input
                  type="password"
                  placeholder="Masukan kata sandi"
                  id="password-input-login"
                  name="password"
                  required
                />
                <button
                  type="button"
                  id="password-toggle-btn-login"
                  onclick="togglePasswordVisibility('password-input-login', 'password-toggle-btn-login')"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <div class="text"><a href="#">Lupa kata sandi?</a></div>
              <div id="msg-login" class="form-group"></div>
              <div class="button input-box">
                <input type="submit" value="Masuk" id="login-button" />
              </div>
              <div class="text sign-up-text">
                Belum memiliki akun? <label for="flip">Daftar sekarang</label>
              </div>
            </div>
          </div>
          <div class="signup-form">
            <div class="title">Daftar Akun</div>
            <div class="input-boxes">
              <div class="input-box">
                <i class="fas fa-user"></i>
                <input
                  type="text"
                  placeholder="Masukan nama Anda"
                  id="name-input"
                  name="name"
                  required
                />
              </div>
              <div id="msg" class="form-group"></div>
              <div class="input-box">
                <i class="fas fa-envelope"></i>
                <input
                  type="text"
                  placeholder="Masukan email Anda"
                  id="email-input-register"
                  name="email"
                  required
                  oninvalid="this.setCustomValidity('Masukan email yang valid')"
                  onchange="this.setCustomValidity('')"
                />
              </div>
              <div id="msg-email" class="form-group"></div>

              <div class="input-box">
                <i class="fas fa-lock"></i>
                <input
                  type="password"
                  placeholder="Masukan password"
                  id="password-input-register"
                  name="password"
                  required
                />
                <button
                  type="button"
                  id="password-toggle-btn-register"
                  onclick="togglePasswordVisibility('password-input-register', 'password-toggle-btn-register')"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <div class="input-box">
                <i class="fas fa-lock"></i>
                <input
                  type="password"
                  placeholder="Masukan ulang password"
                  id="confirm-password-input"
                  name="confirm_password"
                  required
                  oninput="checkPasswordMatch()"
                />
                <button
                  type="button"
                  id="confirm-password-toggle-btn"
                  onclick="togglePasswordVisibility('confirm-password-input', 'confirm-password-toggle-btn')"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <div id="msg-confirm-password" class="form-group"></div>
              <div class="button input-box">
                <input
                  type="submit"
                  value="Daftar"
                  id="register-button"
                  disabled
                />
              </div>
              <div class="text sign-up-text">
                Sudah memiliki akun? <label for="flip">Masuk sekarang</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      // Toggle password visibility
      function togglePasswordVisibility(inputId, buttonId) {
        const passwordInput = document.getElementById(inputId);
        const passwordToggleBtn = document.getElementById(buttonId);
        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          passwordToggleBtn.innerHTML = '<i class="fas fa-eye-slash"></i>';
        } else {
          passwordInput.type = "password";
          passwordToggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
        }
      }
      $(document).ready(function () {
        // Login form submission
        $("#login-button").click(function (e) {
          e.preventDefault();
          var email = $("#email-input-login").val();
          var password = $("#password-input-login").val();
          $.post("./PHP/login-process.php", {
            email: email,
            password: password,
          }).done(function (data) {
            if (data == 1) {
              $("#login-form").submit();
              window.location.href = "./dashboard.html";
            } else {
              $("#msg-login").html(
                '<span class="text-danger">Email atau kata sandi salah!</span>'
              );
            }
          });
        });

        // Registration form validation
        $("#name-input").blur(function (e) {
          var uname = $(this).val();
          if (uname == "") {
            $("#msg").html("");
            $("#register-button").attr("disabled", true);
          } else if (uname.length < 4) {
            $("#msg").html(
              '<span class="text-danger">Nama harus lebih dari 4 karakter!</span>'
            );
            $("#register-button").attr("disabled", true);
          } else {
            $("#msg").html("checking...");
            $.post("./PHP/check_username.php", { username: uname }).done(
              function (data) {
                if (data > "0") {
                  $("#msg").html(
                    '<span class="text-danger">Nama sudah diambil!</span>'
                  );
                  $("#register-button").attr("disabled", true);
                } else {
                  $("#msg").html(
                    '<span class="text-success">Nama tersedia!</span>'
                  );
                  $("#register-button").attr("disabled", false);
                }
              }
            );
          }
        });

        $("#email-input-register").blur(function (e) {
          var email = $(this).val();
          if (email == "") {
            $("#msg-email").html("");
            $("#register-button").attr("disabled", true);
          } else if (!isValidEmail(email)) {
            $("#msg-email").html(
              '<span class="text-danger">Email is not valid!</span>'
            );
            $("#register-button").attr("disabled", true);
          } else {
            $("#msg-email").html("checking...");
            $.post("./PHP/check_email.php", { email: email }).done(function (
              data
            ) {
              if (data > "0") {
                $("#msg-email").html(
                  '<span class="text-danger">Email is already taken!</span>'
                );
                $("#register-button").attr("disabled", true);
              } else {
                $("#msg-email").html(
                  '<span class="text-success">Email Tersedia!</span>'
                );
                $("#register-button").attr("disabled", false);
              }
            });
          }
        });

        function isValidEmail(email) {
          var emailRegex = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/;
          return emailRegex.test(email);
        }

        // Registration form submission
        $("#register-button").click(function (event) {
          event.preventDefault();
          var name = $("#name-input").val();
          var email = $("#email-input-register").val();
          var password = $("#password-input-register").val();
          var confirm_password = $("#confirm-password-input").val();
          if (name == "" || email == "" || password == "") {
            $("#register-button").attr("disabled", true);
          }
          if (password !== confirm_password) {
            $("#msg-confirm-password").html(
              '<span class="text-danger">Password tidak sama!</span>'
            );
            return;
          } else {
            $("#msg-confirm-password").html("");
          }
          $.post("./PHP/register-process.php", {
            name: name,
            email: email,
            password: password,
          }).done(function (data) {
            alert("Registrasi berhasil!");
            window.location.href = "./dashboard.html";
          });
        });
      });
    </script>
  </body>
</html>
